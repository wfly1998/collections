# 利用质量测度从多个图像中自动进行三维人脸重建

> Automated 3D Face Reconstruction from Multiple Images using Quality Measures

$$
\text{Marcel Piotraschke and Volker Blanz}\\\text{Institute for Vision and Graphics, University of Siegen, Germany}\\\text{piotraschke@nt.uni-siegen.de, blanz@informatik.uni-siegen.de}
$$

## 摘要

如果图像材料在姿势，光照，遮挡和面部表情方面是困难的，并且如果初始2D特征位置不准确或不可靠，则从图像自动3D重建面部是具有挑战性的。我们提出了一种方法，从一个人的多个单个图像重建单个3D形状，判断它们的质量，然后结合所有结果中的最佳结果。这是针对脸部的不同区域单独完成的。该算法的核心要素和我们论文的重点是一种质量测量，它可以在没有真实形状信息的情况下判断重建。我们评估不同的质量测量，开发结合方法，并提供完整的自动化重建处理流程。

## 1. 介绍

通过拟合可变形面部模型（例如3D可变形模型（3DMM））从图像重建3D面部的算法依赖于面部[7]或一组特征点坐标[8]的相对精确的初始定位。对于自动化程序，可以直接将这些算法与自动面部和界标检测相结合，例如Zhu和Ramanan [33]或其他特征检测器[11]的算法。然而，在实践中，这种组合比预期的更具挑战性，提出了一些基本问题。特征点检测是一项非常重要的任务，特别是如果图像材料包括复杂的照明，面部表情，皱纹，眼镜或面部毛发。因此，这些特征可能不准确，有些甚至可能是异常值。此外，3DMM拟合的最佳特征集包括不易检测的点，例如面部轮廓和耳朵。这些点对于3DMM收敛到正确的姿势角度是必要的，这反过来影响形状估计。

> Fig 1: 基于段的加权线性组合用于创建最终头部形状。体重随着等级而降低。不可信的部分被丢弃。请注意，每个面部片段都是单独处理的。可选地，可以从输入图像之一中提取纹理。

因此，现有方法的简单组合产生的结果比手动标记的特征所获得的结果差得多。尝试使3DMM更加稳健[10]是有希望的，但仍然不够。相反，我们认为在许多现实世界的应用程序中，不止一个人的图像可用，因此自动算法可以利用来自多个图像的冗余数据来获得稳健性和可靠性。我们的算法优于现有的多个图像同步三维重建方法[7]，这可能是由于特征位置的异常值对同时最小二乘解决方案产生不利影响。

相比之下，我们的算法从每个输入图像计算单独的重建，然后将它们组合成最佳的整体解决方案。我们提出了一种方法，该方法选择最合理的重建，分别在面部的不同区域上操作，并将它们合并为单个3D面部。

我们算法的关键组成部分是基于表面法线的三维重建视觉质量的新度量。对计算机图形和视觉中的视觉质量进行自动评估是一项基本挑战。简单的图像比较是不够的，因为它们对小但重要的错误和伪像不敏感。 3D中的欧几里德距离高估了与人类观察者无关的全局形状变形。马哈拉诺比斯距离也与人的质量等级不一致。在与人类受试者的质量评级进行的实验比较中，我们新的，基于正常的测量结果执行这些现有标准。

总之，本文的贡献是：

* 形状重建的质量（自然性）的一般度量，
* 用于选择和组合来自不同输入图像的不同面部区域（片段）的重建到单个3D面部的算法， 
* 自动算法，可根据人的多个图像生成3D形状重建，这超出了地标检测和3DMM拟合的简单组合。

## 2. 相关工作

尽管已经发布了与2D图像的高质量3D面部重建有关的几种方法，但是自动重建仍然是一项具有挑战性的任务，尤其是面部表情。通常很难找到具有中性表达的图像，因为大多数人倾向于在肖像中微笑。

在关于面部建模的文献中，可以找到几种不同的方法。对于用于计算机游戏和电影的高质量3D面部重建，最先进的技术仍然需要使用激光扫描仪或多视图相机设置对人进行3D扫描[3,9,4,5,12,21,2]。另外，需要大量的后处理来组合所生成的3D数据并在不同的面部表情和视位之间变形以逼真地对主体面部进行动画制作。

像本文中介绍的方法试图消除对特殊设备的需求。相反，他们利用可以使用标准设备或已经可用的数据轻松生成的数据，例如照片或视频数据。多视图几何[26,14,28,13]是从几个单个图像或视频帧重建3D形状的常用过程。尽管这些算法对于不同场景的使用非常灵活，这些场景不同于建筑物的重建，较小的物体甚至是面部，但是它们不能充分地处理一系列输入图像内的非刚性变换（面部表情）。

其他近期出版物通过将3D面部与单个或多个图像以及视频帧对齐而显示出有希望的结果。 Park等的方法。 al [22]，Aldrian和Smith [1]和Dou等。 al [24]从单个图像重建3D形状。王等人。 [30]从几个输入图像中提取轮廓以重建3D形状，而Roth等。 [27]使用图像集合进行基于光学立体的正常估计，迭代地优化表面重建。通过估计姿势并计算光流，执行3D形状的高细节细化，从而产生3D到2D的对应[20,18,15,29]。 Suwajanakorn等。 al [29]甚至捕获了像皱纹这样的细节，[19] Kemelmacher-Shlizerman和Seitz表明，“野外的面孔”也可以得到妥善处理。但是这些方法缺乏额外的3D到3D对应。在本文中，我们讨论3D到2D以及3D到3D的对应关系。

为了从2D图像重建脸部的3D形状，Blanz和Vetter [7]介绍了3DMM。通过巴塞尔人脸模型[23]，3DMM已经向公众和朱等人提供。 al [34]提出了一种基于局部特征的辨别3DMM，可以提供准确的重建。 3DMM的一个常见且显着的缺点是在“野外面部”的情况下缺乏鲁棒性，特别是如果未完全检测到面部标志。虽然布鲁尔等人。 [11]建议使用支持向量机进行自动三维人脸重建，并在[10]中提出了在某种程度上纠正错位标志的想法，这两种实现都不够强大，无法处理由面部表情或复杂光照条件引起的困难场景。通过本文中的方法，我们的目标是克服3DMM的先前缺点。

此外，还有一些方法不是直接重建面部，而是通过检测面部，估计姿势，定位特征点或对齐面部几何形状为进一步处理提供了坚实的基础[33,32,25,31,17]。

## 3. 3D变形模型

3D可变形模型[7]是3D形状和纹理的向量空间，$\mathbf S_i=(X_1,Y_1,Z_1,X_2,\dots,Z_n)^T$和$\mathbf T_i=(r_1,g_1,b_1,\dots,b_n)^T$，具有$X,Y,Z$坐标和$r,g,b$颜色，$n=113\ 753$个顶点。在我们的实验中，3DMM由200个人的3D扫描和35个额外的扫描构成，这些扫描显示单个个体的面部表情[6]。在各个形状，表达式和纹理上，PCA分别定义了特征向量$\mathbf s_i,\mathbf u_i$和$\mathbf t_i$，以及平均形状和纹理$\bar{\mathbf s}$和$\bar{\mathbf t}$。在此基础上，新面可以通过线性组合来近似
$$
\mathbf S=\bar{\mathbf s}+\sum_{i=1}^m\alpha_i\mathbf s_i+\sum_{i=1}^p\gamma_i\mathbf u_i\quad\mathbf T=\bar{\mathbf t}+\sum_{i=1}^m\beta_i\mathbf t_i.\tag1
$$
我们使用$m=100$个特征向量用于个体变化，$p=4$用于最重要的面部表情自由度，重点是嘴部运动。

请注意，高比例的图像，例如数据库中的“野外脸部”图像，涉及非中性的面部表情，因此我们将多个图像组合的方法仅适用于这种额外的自由度。我们使用单独的PCA和基础向量进行形状和表达，以便能够在拟合后给出3D面中性表达式（$\gamma_i=0$）。

通过将模型拟合到图像来进行3D形状重建基本上是图像距离的最小化
$$
d_{image}=\sum_{u,v}\|I_{input}(u,v)-I_{model}(u,v)\|^2\tag2
$$
在所有3个颜色通道中，相对于线性系数$\alpha_i,\gamma_i,\beta_i$和控制姿势，光照和其他参数的一些成像参数$\rho_i$（详见[7]）。

通过正则化项来避免过度拟合，即马哈拉诺比斯距离起始条件的距离，
$$
d_{maha}=\sum_i\frac{\alpha_i^2}{\sigma_{S,i}^2}+\sum_i\frac{\gamma_i^2}{\sigma_{S,i}^2}+\sum_i\frac{\beta_i^2}{\sigma_{S,i}^2}+\sum_i\frac{(\rho_i-\bar{\rho_i})^2}{\sigma_{R,i}^2},\tag3
$$
其中$\rho_i$表示渲染参数的起始值，$\sigma$是与PCA的标准偏差。

随机牛顿优化算法最小化$d_{image},d_{maha}$和附加项的加权和
$$
d_{features}=\sum_j\|\left(\begin{aligned}\ x_j\\y_i\end{aligned}\ \right)-\left(\ \begin{aligned}P_x(X_{k_j},Y_{k_j},Z_{k_j})\\P_y(X_{k_j},Y_{k_j},Z_{k_j})\end{aligned}\ \right)\|^2\tag4
$$
这是2D特征位置$x_j,y_j$与相应顶点$k_j$的投影位置之间的平方距离之和，具有透视投影$P$ [8]。$d_{features}$仅用于初始化，权重随着拟合的进行而减少。

与之前关于3DMM拟合[8]的工作不同，我们使用Zhu和Ramanan [33]的特征检测算法进行自动化处理。这些功能的精度降低以及功能（轮廓，耳朵）的次优选择会显着影响输出质量。在本文的其余部分，我们将介绍如何根据人的一组给定图像选择最成功的重建，以及如何将这些重建结合到3D面部。

## 4. 质量措施

对于有意义的质量测量，重要的是独立于面部表情。因此，除了图像距离之外，我们在本节中使用“中和”面部表情（$\gamma_i=0$）。因为图像距离将渲染的重建与原始输入图像进行比较，所以它需要尽可能接近原始面部。

> Fig 2: 通过用修改版本减去输入图像来计算图像距离，其中重建的面部被渲染在原始面部的顶部。

### 4.1 图片距离

与本文讨论的所有其他距离函数相比，图像距离$d_{image}$等式(2)是唯一一个惩罚原始面孔和重建之间差异的人。其他距离测量仅估计重建面部的自然性的合理性。

图2说明了这种误差函数的一个主要缺点：不可能惩罚投影面不会遮挡输入图像中的完整面部的事实。奥巴马的右耳就是这种情况。在$I_{input}-I_{model}$中，右耳的大多数像素的图像距离为零，因此误差非常小。重建的耳朵呈现在脸颊上，但由于颜色相似，这对$d_{image}$的影响也很小。通常，$d_{image}$无法捕获重建中的小但相关的错误和伪像。

另一方面，即使面部看起来相似，例如当整体色调错误或面部稍微偏移时，$d_{image}$也可以是高的。所有这些问题都是由于$d_{image}$是所有像素的总和并且许多小错误计数超过几个大错误的事实引起的。

尽管$d_{image}$对于评估3D重建的质量或合理性是不是最理想的，正如我们将在第5节中演示的那样，在拟合过程中使用$d_{image}$是有意义的，因为与以下标准不同，它测量距离从输入面，它很容易计算。

### 4.2 马氏距离

考虑到训练数据中观察到的标准偏差，马哈拉诺比斯距离使用PCA测量当前解与平均面的距离。它与由PCA估计的多元高斯概率密度函数直接相关。正如图像距离一样，马哈拉诺比斯距离已经集成在3DMM拟合程序中。对于第5节中的实验，我们只想评估重建形状的质量，我们简化了等式(3)为
$$
d_{maha}=\sum_i\frac{\alpha_i^2}{\sigma_{S,i}^2},\tag5
$$
所以我们只测量中性面形状与平均面的距离，而省略表达式，纹理和渲染参数。动机是，与中性形状不同，如果输入图像不常见（头发，面部毛发，眼镜，微笑），成功重建的纹理和表达可能远离平均值。

### 4.3 欧氏距离

3DMM形状与平均面的距离的更直接测量是重建的形状矢量（具有中和的表达式）$\mathbf S$与平均矢量$\bar{\mathbf s}$之间的欧几里德距离：
$$
d_{eucl}(\mathbf S,\bar{\mathbf s})=\sqrt{\sum_{i=1}^{3n}(\mathbf S_i-\bar{\mathbf s}_i)^2}=\|\mathbf S-\bar{\mathbf s}\|_2.\tag6
$$
请注意，$d_{eucl}$对面部的刚性变换很敏感。通过构造，3DMM形状矢量以最小二乘意义对齐。在3DMM拟合中，刚性变换在外部应用于这些，并通过渲染参数$\rho_i$捕获（第3节）。尽管如此，$d_{eucl}$的一般缺点仍然是简单的全局变换，例如：各向异性缩放，不影响自然性或形状相似性，但对$d_{eucl}$有显着影响。

等式(6)倾向于在平方距离之和中高估异常值顶点。对于评估（第5节），我们还考虑了修改的距离，它是3D顶点距离（每个顶点水平上的平方根）的总和。但我们没有发现任何改进，因此第5节仅涉及公式(6)。

### 4.4 法线距离

我们已经观察到表面的局部或甚至全局扭曲是失败的3D面部重建的共同特征。对于大多数或可能所有3DMM算法（参见第2节）和 - 在不同的上下文中 - 甚至对于诸如扫描仪或立体和多视图技术的3D形状捕获设置也是如此。对于形状拟合算法，失败的重建不太可能未对准并且仍然接近平均值，因为未对准倾向于对拟合算法的成本函数具有不期望的影响并且因此导致远离该组似乎合理的面。在我们的背景下，错位可能是由不准确的初始特征位置引起的。此外，重建失败的其他潜在原因，例如照明效果，遮挡或极端面部表情，往往导致算法远离平均值，并且对此非常敏感的测量是表面法线与平均值的偏差。

> Fig3: 通过计算每个对应顶点对的平均法线（图3a）和重建面（图3b）之间的角度来确定法线距离（参见图3c）。这些值是每段（参见图4a）或面的平均值，以获得全局距离值。

我们想指出正则化机制，例如等式(3)可以减少这种影响，并使解决方案接近平均值。尽管如此，出于实际目的，我们已经观察到(1)如果正则化的权重太大，则意味着图像上的次优结果将被成功地重建，因此在质量和鲁棒性之间存在基本的权衡，并且(2)正则化方程(3)不是面部可塑性的可靠测量，我们将在第5节中看到。

基于3DMM的顶点$i$之间的密集点对点对应，新的距离测量$d_{normal}$分析重建面的表面法线$n_i$与平均面的法线$n_i^\prime$：
$$
d_{normal}=\frac1n\sum_{i=1}^n\arccos\frac{\mathbf n_i\cdot\mathbf n_i^\prime}{\|\mathbf n_i\|\ \|\mathbf n_i^\prime\|}.\tag7
$$
这个正常距离的想法如图3所示。注意，与$d_{eucl}$不同，$d_{normal}$对缩放和移位不敏感。通过将整个面部分割成不同的面部区域（眼睛，嘴巴，鼻子和周围区域，见图4a），可以定义单独的距离$d_{normal}$，其分别反映区域的可能性。我们将在第6节中使用这个想法。

在人脸中，鼻子，眼睛或嘴唇上的某些顶点的法线比其他顶点的变化更大。我们已经分析了3DMM的原始200个3D扫描，并创建了不同的重量图$\omega$（参见图4b），通过将具有高正常变化的区域（考虑它们最大的诊断）或向下（归一化）进行缩放来解释这些局部差异。 ）。在第一步中，我们从所有200个面中的每个顶点i中的平均法线$n_i^\prime$计算法线$n_i$的平均偏离角$\bar{\phi}_i$。然后，我们找到了由$\hat\omega_i=1-\frac{\bar\phi_i-\bar\phi_{min}}{\bar\phi_{max}-\bar\phi_{min}}$定义的最好的权重图，并且加权的法线距离是
$$
d_{normalW}=\frac1n\sum_{i=1}^n\hat\omega_i\arccos\frac{\mathbf n_i\cdot\mathbf n_i^\prime}{\|\mathbf n_i\|\ \|\mathbf n_i^\prime\|},\tag8
$$
我们获得了实验结果，这些结果将在下一节中进行总结。

> Fig 4: 图4a显示了不同的面部区段。基于3DMM的权重图如图4b所示。

## 5. 评估距离测量

该评估的目标是找出哪个质量测量最接近人类观察者将分配给不同重建的评级。对于人类而言，质量可能意味着3D脸部的外观和合理程度，以及它与图像中人物的相似程度。对于失败的重建，两个标准通常同时被违反，因此第4节的距离度量是好的候选者，即使大多数不测量与输入面的相似性。

### 5.1 评价1

第一个排名是根据自动检测到的地标，从Barack Obama的照片中进行的24次3D重建。地标的自动检测基于Zhu和Ramanan [33]的方法。通过在相同的输入图像上使用手动选择的界标来创建另外一组24个重建。同样，第4节中介绍的算法距离度量用于执行排名。所有重建都是从单个图像中创建的，如第3节所述。

我们要求四个天真的参与者根据感知的重建质量，在两组24个重建中的每一个中创建排名。组合各个用户排名以定义总体排名列表，其与每个距离度量的排名进行比较。从表1中可以看出，马哈拉诺比斯和普通距离的平均和最大误差（分配给每次重建的等级的差异）远小于基于欧几里德和图像距离的误差。此外，基于$d_{normalW}$的数字（参见方程8），可以注意到，与基于$d_{normal}$的排序相比，权重图的影响不是很强（参见方程7）。

> Fig 5: 

在图5中，每个距离测量的相关性是可视化的：水平轴描述了平均用户排名，而每个距离测量被映射到垂直轴。如果距离度量与用户排名完全相关，则散点图的点沿对角线对齐。从图5a中可以看出，对于图像距离，点被广泛分散。对于图5b中的欧几里德距离可以观察到相同的情况。因此，这两种措施对于以与用户的意见相关的方式区分似是而非的难以置信的重建是没有用的。对于马氏距离（参见图5c）和正常距离（参见图5d），用户评级与基于算法距离测量的评级之间的相关性清晰可见。特别是正常距离预测了我们参与者的大部分质量判断。所有2·24次重建（自动和手动）的相关性均为$d_{image}$：0.27，对于$d_{eucl}$：0.27，对于$d_{maha}$：0.85，对于$d_{normal}$：0.94。

> Table 1: 根据四个幼稚参与者的感知质量，24个自动重建和24个手动选择地标的等级的平均和最大差异（见第5.1节）。

在第二次评估中，基于奥巴马（24幅图像），劳伦斯（32幅图像），安南（32幅图像），沃森（46张图像）和卡瑞尔（28幅图像）的图像进行3D重建。同样创建了两个不同的集合，但这次只使用了自动选择的地标。第一组是通过拟合到单个图像而创建的，而对于第二组，通过应用Blanz和Vet ter [7]的多重拟合方法，形成了两个图像的同时拟合。选择固定的参考图像，然后将该图像与该人的集合的每个其他图像组合。请注意，面部标志与第5.1节中的标志不同。因此，虽然相同的输入图像用于奥巴马数据集，但重建是不同的。

对于每个数据集，距离度量用于创建排名列表。然后我们让七位天真的参与者对每次3D重建进行评分。可能的评级是“非常好”，“好”，“可接受”或“失败”。个人评级被平均，然后用于创建排名。许多重建获得了相同的平均评级，因此排名中的许多位置是共享的。这意味着来自人类的排名列表与距离度量排名列表之间的差异高于评估1，我们要求参与者直接创建一个独特的排名。尽管如此，正常距离最符合用户评级，如表2和表3所示。

> Table 2: 基于七个幼稚参与者的感知质量，来自单个图像的重建的平均值和最大值（括号内）差异（参见第5.2节）。

> Table 3: 基于七个幼稚参与者的感知质量，来自多个图像的重建的等级的平均值和最大值（括号内）差异（参见第5.2节）。

## 6. 每段加权线性组合

我们在本文中提出的自动3D重建通过使用多个面部图像来补偿自动检测到的特征位置的降低的精度和可靠性。请注意，与立体和多视图算法不同，我们允许由于面部表情导致的非刚性变形，以及（未知）成像条件的巨大差异。

> Fig 6: 使用正常距离和随后排序的基于单个图像的重建的可信度等级。

我们的策略是根据Zhu和Ramanan [33]算法检测到的地标，分别对人的每个输入图像应用单图像3DMM拟合（第3节），选择最佳结果（图1和图6） ）在每个段（图4a）上使用$d_{normal}$，计算这些的加权线性组合并将它们合并为单个3D面。

每个片段的形状由基于排名列表顺序的相应片段的加权线性组合确定。体重随着等级而降低。因此，每个单独部分的组合形状
$$
\mathbf S_{seg}=\sum_{i=0}^{m-1}\alpha_i\mathbf S_{seg,i}\tag9
$$
通过$m$个单独的重建来确定相应的段$\mathbf S_{seg,i}$加权by
$$
\alpha_i=\frac{1-(i\cdot\frac1m)}{\sum_{c=0}^{m-1}1-(c\cdot\frac1m)}\tag{10}
$$
该算法总结在图1中。注意，为了说明，图6和1指的是整个面的形状，而不是像我们的算法中的单独的段。

我们算法的一个重要元素是定义阈值质量值，该值确定在加权和中考虑哪些重建。根据第5节的数据，我们估计了一个将似乎合理的重建与难以置信的重建分开的阈值。在评估1中，还向参与者询问哪些面部仍然合理，哪些面部不合理。在评估2中，阈值应该在评级“可接受”和“失败”之间。对于两个数据集，我们使用算术平均值和任一组中的$d_{normal}$的估计标准偏差估计高斯分布$p_0(u)$和$p_1(u)$用于合理且难以置信的重建。

在最大似然法中，阈值等于高斯分布$p_0(u)$和$p_1(u)$的交叉点。根据我们的数据，该阈值等于$u=11$，如图7所示，并且可以通过求解$p_0(u)=p_1(u)$来计算。



# 后面先不写了









































